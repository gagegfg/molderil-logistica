<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MOLDERIL - Escáner de Inventario</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM CDNs for browser usage -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel CDN to compile JSX in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- jsPDF CDN for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- html5-qrcode CDN for QR scanning -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <!-- Font Awesome for camera icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans">

  <div id="root"></div>

  <!-- Main application script. Uses type="text/babel" to let Babel compile JSX -->
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;
    const { createRoot } = ReactDOM;

    // Componente dedicado para el escáner QR. Encapsula toda la lógica de la cámara.
    const QrScanner = ({ onScanSuccess, onStop, onError }) => {
      const qrCodeScanner = useRef(null);
      const readerId = "reader";
      
      useEffect(() => {
        // Inicializa y empieza el escáner cuando el componente se monta
        qrCodeScanner.current = new Html5Qrcode(readerId);
        const config = { fps: 10, qrbox: { width: 250, height: 250 } };

        qrCodeScanner.current.start(
          { facingMode: "environment" },
          config,
          (decodedText) => {
            onScanSuccess(decodedText);
            onStop(); // Detiene la cámara después de un escaneo exitoso
          },
          (errorMessage) => {
            // Ignorar errores de escaneo menores
          }
        )
        .then(() => {
          console.log("Cámara iniciada con éxito.");
        })
        .catch((err) => {
          console.error("Error al iniciar la cámara:", err);
          onError('Error: No se pudo iniciar la cámara. Asegúrate de dar los permisos necesarios.');
          onStop();
        });

        // Función de limpieza para detener la cámara cuando el componente se desmonta
        return () => {
          if (qrCodeScanner.current && qrCodeScanner.current.isScanning) {
            qrCodeScanner.current.stop().then(() => {
              console.log("Cámara detenida por limpieza del componente.");
            }).catch((err) => {
              console.error("Error al detener la cámara:", err);
            });
          }
        };
      }, []); // Array de dependencia vacío para que se ejecute solo una vez al montar

      return <div id={readerId} className="w-full max-w-sm"></div>;
    };

    const App = () => {
      // Application state
      const [items, setItems] = useState([]);
      const [operarioLegajo, setOperarioLegajo] = useState('');
      const [clienteNombre, setClienteNombre] = useState('');
      const [isDataEntered, setIsDataEntered] = useState(false);
      const [mockQrValue, setMockQrValue] = useState('');
      const [isGenerating, setIsGenerating] = useState(false);
      const [generationStatus, setGenerationStatus] = useState('Listo');
      const [isPdfLibLoaded, setIsPdfLibLoaded] = useState(false);
      const [isCameraActive, setIsCameraActive] = useState(false);
      const [showErrorModal, setShowErrorModal] = useState(false);
      const [errorMessage, setErrorMessage] = useState('');
      
      const legajoInputRef = useRef(null); // Reference to the legajo input field

      // Effect to check if jsPDF library is loaded and focus on legajo field
      useEffect(() => {
        if (window.jspdf) {
          setIsPdfLibLoaded(true);
          setGenerationStatus('Librería de PDF cargada.');
        } else {
          setGenerationStatus('Error cargando librería de PDF.');
          setErrorMessage('Error: No se pudo cargar jsPDF. Intenta refrescar la página.');
          setShowErrorModal(true);
        }
        
        if (!isDataEntered && legajoInputRef.current) {
          legajoInputRef.current.focus();
        }
      }, [isDataEntered]);

      // Handler for scanning a QR code value
      const handleScan = (value) => {
        if (!value) return;

        // Nuevo formato de QR: SKU;Descripcion;Lote;F.Produccion;F.Vencimiento;Cantidad;U.M.
        const parts = value.split(';');
        const [sku, descripcion, lote, fechaProduccion, fechaVencimiento, cantidad, unidadMedida] = parts;
        
        if (!sku || !descripcion || !lote || !fechaProduccion || !fechaVencimiento || !cantidad || !unidadMedida) {
          setErrorMessage(`Error: El código QR no tiene el formato correcto (SKU;Descripcion;Lote;F.Prod;F.Venc;Cantidad;U.M.).`);
          setMockQrValue('');
          setTimeout(() => setErrorMessage(''), 3000);
          return;
        }

        const isDuplicate = items.some(item => item.sku === sku && item.lote === lote);

        if (isDuplicate) {
          setErrorMessage(`Error: El artículo con SKU "${sku}" y Lote "${lote}" ya fue cargado.`);
          setMockQrValue('');
          setTimeout(() => setErrorMessage(''), 3000);
          return;
        }

        const newItem = {
          id: Date.now(),
          sku: sku,
          descripcion: descripcion,
          lote: lote,
          fechaProduccion: fechaProduccion,
          fechaVencimiento: fechaVencimiento,
          cantidad: cantidad,
          unidadMedida: unidadMedida,
          controlado: false,
        };
        
        setItems([newItem, ...items]);
        setMockQrValue('');
      };

      // Handler to delete an item from the list
      const handleDelete = (id) => {
        setItems(items.filter(item => item.id !== id));
      };
      
      // Handler to check/uncheck an item as controlled
      const handleControlCheck = (id) => {
        setItems(prevItems => prevItems.map(item => 
          item.id === id ? { ...item, controlado: !item.controlado } : item
        ));
      };
      
      // Handler for the Enter key in the QR scan input
      const handleKeyDown = (e) => {
        if (e.key === 'Enter') {
          handleScan(mockQrValue);
        }
      };

      // Handler for the Enter key in the initial form
      const handleFormEnter = (e) => {
        if (e.key === 'Enter' && operarioLegajo && clienteNombre) {
          setIsDataEntered(true);
        }
      };

      // PDF generation function
      const generatePDF = async () => {
        setIsGenerating(true);
        setErrorMessage('');
        setGenerationStatus('Iniciando...');

        try {
          if (!window.jspdf) {
            throw new Error("La librería jsPDF no está cargada. Por favor, refresca la página.");
          }

          const { jsPDF } = window.jspdf;
          
          setGenerationStatus('Preparando documento...');
          const pdf = new jsPDF('l', 'mm', 'a4'); // Cambiado a orientación 'l' (landscape) para más columnas
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = pdf.internal.pageSize.getHeight();
          let yPosition = 15;
          const margin = 10;
          const pageWidth = pdfWidth - (2 * margin);

          // Add MOLDERIL text as a heading
          pdf.setFont('helvetica', 'bold');
          pdf.setFontSize(28);
          pdf.text("MOLDERIL", margin, yPosition);
          yPosition += 15;

          // Add contact details
          pdf.setFont('helvetica', 'normal');
          pdf.setFontSize(10);
          pdf.text("ADMINISTRACION Y VENTAS: AV. Hermanos Lescano 550-Rio Primero (Cordoba)", margin, yPosition);
          yPosition += 5;
          pdf.text("Tel/Fax: 03574-420768 (lineas Rotativas)", margin, yPosition);
          yPosition += 10;
          
          pdf.setFontSize(16);
          pdf.text("LISTA DE EMPAQUE", margin, yPosition);
          yPosition += 10;

          pdf.setFontSize(12);
          pdf.text(`Legajo de Operario: ${operarioLegajo}`, margin, yPosition);
          yPosition += 7;
          pdf.text(`Cliente: ${clienteNombre}`, margin, yPosition);
          yPosition += 7;
          pdf.text(`Fecha de Generación: ${new Date().toLocaleDateString()}`, margin, yPosition);
          yPosition += 10;

          setGenerationStatus('Generando tabla...');
          
          // Updated Table Headers with the new columns
          const headers = ["SKU", "Descripción", "Lote", "F. Producción", "F. Vencimiento", "Cantidad", "U.M.", "Control"];
          // Proportional widths for landscape orientation
          const colWidths = [0.1, 0.3, 0.15, 0.1, 0.1, 0.08, 0.05, 0.12];
          const columnPositions = [
              margin,
              margin + pageWidth * colWidths[0],
              margin + pageWidth * (colWidths[0] + colWidths[1]),
              margin + pageWidth * (colWidths[0] + colWidths[1] + colWidths[2]),
              margin + pageWidth * (colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3]),
              margin + pageWidth * (colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4]),
              margin + pageWidth * (colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4] + colWidths[5]),
              margin + pageWidth * (colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4] + colWidths[5] + colWidths[6]),
          ];

          pdf.setFont('helvetica', 'bold');
          pdf.setFontSize(8); // Fuente más pequeña para que quepan las columnas
          
          // Draw header row
          pdf.setFillColor(240, 240, 240); // Light gray background
          pdf.rect(margin, yPosition, pageWidth, 7, 'F');
          pdf.text(headers[0], columnPositions[0] + 2, yPosition + 5);
          pdf.text(headers[1], columnPositions[1] + 2, yPosition + 5);
          pdf.text(headers[2], columnPositions[2] + 2, yPosition + 5);
          pdf.text(headers[3], columnPositions[3] + 2, yPosition + 5);
          pdf.text(headers[4], columnPositions[4] + 2, yPosition + 5);
          pdf.text(headers[5], columnPositions[5] + 2, yPosition + 5);
          pdf.text(headers[6], columnPositions[6] + 2, yPosition + 5);
          pdf.text(headers[7], columnPositions[7] + 2, yPosition + 5);
          
          yPosition += 7;
          
          // Draw horizontal line after header
          pdf.line(margin, yPosition, pdfWidth - margin, yPosition);
          
          pdf.setFont('helvetica', 'normal');
          
          const rowHeight = 7;
          const startTableY = yPosition;

          // Loop through items and add to PDF
          items.forEach((item, index) => {
            // Check for page break
            if (yPosition + rowHeight > pdfHeight - margin - 20) {
              pdf.addPage();
              yPosition = margin;
              
              // Redraw header on new page
              pdf.setFillColor(240, 240, 240);
              pdf.rect(margin, yPosition, pageWidth, rowHeight, 'F');
              pdf.setFont('helvetica', 'bold');
              pdf.setFontSize(8);
              pdf.text(headers[0], columnPositions[0] + 2, yPosition + 5);
              pdf.text(headers[1], columnPositions[1] + 2, yPosition + 5);
              pdf.text(headers[2], columnPositions[2] + 2, yPosition + 5);
              pdf.text(headers[3], columnPositions[3] + 2, yPosition + 5);
              pdf.text(headers[4], columnPositions[4] + 2, yPosition + 5);
              pdf.text(headers[5], columnPositions[5] + 2, yPosition + 5);
              pdf.text(headers[6], columnPositions[6] + 2, yPosition + 5);
              pdf.text(headers[7], columnPositions[7] + 2, yPosition + 5);
              pdf.line(margin, yPosition + rowHeight, pdfWidth - margin, yPosition + rowHeight);
              yPosition += rowHeight;
              pdf.setFont('helvetica', 'normal');
              pdf.setFontSize(8);
            }

            // Draw horizontal line before each row
            pdf.line(margin, yPosition, pdfWidth - margin, yPosition);

            // Add item data
            pdf.text(item.sku, columnPositions[0] + 2, yPosition + 5);
            pdf.text(item.descripcion, columnPositions[1] + 2, yPosition + 5);
            pdf.text(item.lote, columnPositions[2] + 2, yPosition + 5);
            pdf.text(item.fechaProduccion, columnPositions[3] + 2, yPosition + 5);
            pdf.text(item.fechaVencimiento, columnPositions[4] + 2, yPosition + 5);
            pdf.text(item.cantidad, columnPositions[5] + 2, yPosition + 5);
            pdf.text(item.unidadMedida, columnPositions[6] + 2, yPosition + 5);

            // Draw an empty box for manual checking instead of a filled one
            const boxSize = 4;
            const boxX = columnPositions[7] + (pageWidth * colWidths[7] / 2) - (boxSize / 2);
            const boxY = yPosition + (rowHeight / 2) - (boxSize / 2);
            pdf.rect(boxX, boxY, boxSize, boxSize);

            yPosition += rowHeight;
          });

          // Draw final horizontal line at the end of the table
          pdf.line(margin, yPosition, pdfWidth - margin, yPosition);

          // Draw vertical lines for the grid
          pdf.line(columnPositions[0], startTableY, columnPositions[0], yPosition);
          pdf.line(columnPositions[1], startTableY, columnPositions[1], yPosition);
          pdf.line(columnPositions[2], startTableY, columnPositions[2], yPosition);
          pdf.line(columnPositions[3], startTableY, columnPositions[3], yPosition);
          pdf.line(columnPositions[4], startTableY, columnPositions[4], yPosition);
          pdf.line(columnPositions[5], startTableY, columnPositions[5], yPosition);
          pdf.line(columnPositions[6], startTableY, columnPositions[6], yPosition);
          pdf.line(columnPositions[7], startTableY, columnPositions[7], yPosition);
          pdf.line(pdfWidth - margin, startTableY, pdfWidth - margin, yPosition);
          
          // Add total count at the end
          pdf.setFontSize(14);
          pdf.text(`Total de bultos escaneados: ${items.length}`, margin, yPosition + 15);
          yPosition += 30; // Add some space for the signature section

          // Add a space for signature and clarification
          pdf.setFontSize(12);
          pdf.text("Responsable de Carga:", margin, yPosition);
          pdf.line(margin + 50, yPosition, margin + 150, yPosition);
          yPosition += 5;
          pdf.setFontSize(10);
          pdf.text("Firma y Aclaración", margin + 75, yPosition);

          setGenerationStatus('¡PDF generado con éxito!');
          pdf.save(`Lista_Operario_${operarioLegajo}.pdf`);
          setTimeout(() => setGenerationStatus('Listo para generar.'), 3000);
        } catch (error) {
          console.error("Error al generar PDF:", error);
          setGenerationStatus('Error');
          setErrorMessage(`Error en el paso "${generationStatus}": ${error.message}`);
          setShowErrorModal(true);
        } finally {
          setIsGenerating(false);
        }
      };

      // Handler to reset the application
      const handleReset = () => {
        setIsDataEntered(false);
        setOperarioLegajo('');
        setClienteNombre('');
        setItems([]);
        setGenerationStatus('Listo para generar.');
      };
      
      const ErrorModal = ({ onClose, message }) => (
        <div className="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full flex items-center justify-center z-50">
          <div className="relative p-8 bg-white w-full max-w-lg rounded-xl shadow-lg m-4">
            <h3 className="text-2xl font-bold text-red-600 mb-4">Error</h3>
            <p className="text-xl text-gray-700 mb-4">
              {message}
            </p>
            <div className="text-center">
              <button
                onClick={onClose}
                className="bg-red-600 text-white font-semibold py-3 px-6 rounded-md shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-200 text-xl"
              >
                Entendido
              </button>
            </div>
          </div>
        </div>
      );

      // Initial form view
      if (!isDataEntered) {
        return (
          <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4 font-sans">
            {showErrorModal && <ErrorModal onClose={() => setShowErrorModal(false)} message={errorMessage} />}
            <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
              <div className="text-center mb-6">
                <h1 className="text-4xl font-extrabold text-gray-900 tracking-wide" style={{ fontFamily: 'Arial, sans-serif' }}>
                  MOLDERIL
                </h1>
              </div>
              <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">Registro de Operario</h2>
              <div className="space-y-4">
                <div>
                  <label htmlFor="legajo" className="block text-xl font-medium text-gray-700">
                    Legajo de Operario
                  </label>
                  <input
                    type="number"
                    id="legajo"
                    ref={legajoInputRef}
                    value={operarioLegajo}
                    onChange={(e) => setOperarioLegajo(e.target.value)}
                    onKeyDown={handleFormEnter}
                    className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border text-2xl"
                    placeholder="Ej: 12345"
                  />
                </div>
                <div>
                  <label htmlFor="cliente" className="block text-xl font-medium text-gray-700">
                    Nombre del Cliente
                  </label>
                  <input
                    type="text"
                    id="cliente"
                    value={clienteNombre}
                    onChange={(e) => setClienteNombre(e.target.value)}
                    onKeyDown={handleFormEnter}
                    className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border text-2xl"
                    placeholder="Ej: Empresa ABC"
                  />
                </div>
                <button
                  onClick={() => setIsDataEntered(true)}
                  disabled={!operarioLegajo || !clienteNombre}
                  className="w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-md shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 transition-all duration-200 text-xl"
                >
                  Continuar
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Main inventory scanner view
      return (
        <div className="min-h-screen bg-gray-100 p-4 flex flex-col font-sans">
          {showErrorModal && <ErrorModal onClose={() => setShowErrorModal(false)} message={errorMessage} />}
          <div className="bg-white p-6 rounded-xl shadow-lg flex-grow">
            <div className="text-center mb-6">
              <h1 className="text-3xl font-extrabold text-gray-900 tracking-wide mb-2" style={{ fontFamily: 'Arial, sans-serif' }}>
                MOLDERIL
              </h1>
              <p className="text-xl text-gray-600">
                **Legajo:** {operarioLegajo} | **Cliente:** {clienteNombre}
              </p>
            </div>
            
            {isCameraActive ? (
              <div className="flex flex-col items-center space-y-4">
                {/* Renderiza el componente QrScanner solo cuando la cámara está activa */}
                <QrScanner 
                  onScanSuccess={handleScan} 
                  onStop={() => setIsCameraActive(false)}
                  onError={(msg) => {
                    setErrorMessage(msg);
                    setShowErrorModal(true);
                  }}
                />
                <button 
                  onClick={() => setIsCameraActive(false)}
                  className="w-full max-w-sm bg-red-600 text-white font-semibold py-3 px-4 rounded-md shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-200 text-xl"
                >
                  Cancelar Escaneo
                </button>
              </div>
            ) : (
              <>
                <div className="flex space-x-2 mb-4">
                  <input
                    type="text"
                    value={mockQrValue}
                    onChange={(e) => setMockQrValue(e.target.value)}
                    onKeyDown={handleKeyDown}
                    className="flex-grow rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border text-xl"
                    placeholder="Simular escaneo QR (Ej: SKU;Desc;Lote;01/08/2025;01/08/2026;100;Uni)"
                  />
                  <button
                    onClick={() => handleScan(mockQrValue)}
                    disabled={!mockQrValue}
                    className="bg-green-600 text-white font-semibold py-3 px-4 rounded-md shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 transition-all duration-200 text-xl"
                  >
                    Agregar
                  </button>
                  <button
                    onClick={() => setIsCameraActive(true)}
                    className="bg-purple-600 text-white font-semibold py-3 px-4 rounded-md shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 text-xl flex items-center justify-center"
                  >
                    <i className="fas fa-camera mr-2"></i> Escanear
                  </button>
                </div>

                <div className="overflow-x-auto rounded-lg shadow-md mb-6 border">
                  <div id="printable-content">
                    <table className="min-w-full divide-y divide-gray-200 mt-4 table-fixed">
                      <thead className="bg-gray-50">
                        <tr>
                          <th className="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">SKU</th>
                          <th className="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-3/12">Descripción</th>
                          <th className="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">Lote</th>
                          <th className="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">F. Producción</th>
                          <th className="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">F. Vencimiento</th>
                          <th className="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">Cantidad</th>
                          <th className="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">U.M.</th>
                          <th className="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">Control</th>
                          <th className="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">Acciones</th>
                        </tr>
                      </thead>
                      <tbody className="bg-white divide-y divide-gray-200">
                        {items.length === 0 ? (
                          <tr>
                            <td colSpan="9" className="px-2 py-4 text-center text-sm text-gray-500 italic">
                              Aún no hay registros.
                            </td>
                          </tr>
                        ) : (
                          items.map((item) => (
                            <tr key={item.id} className="hover:bg-gray-50 transition-colors duration-150">
                              <td className="px-2 py-4 whitespace-nowrap text-sm font-medium text-gray-900 w-1/12">{item.sku}</td>
                              <td className="px-2 py-4 whitespace-nowrap text-sm text-gray-500 w-3/12">{item.descripcion}</td>
                              <td className="px-2 py-4 whitespace-nowrap text-sm text-gray-500 w-2/12">{item.lote}</td>
                              <td className="px-2 py-4 whitespace-nowrap text-sm text-gray-500 w-1/12">{item.fechaProduccion}</td>
                              <td className="px-2 py-4 whitespace-nowrap text-sm text-gray-500 w-1/12">{item.fechaVencimiento}</td>
                              <td className="px-2 py-4 whitespace-nowrap text-sm text-gray-500 w-1/12">{item.cantidad}</td>
                              <td className="px-2 py-4 whitespace-nowrap text-sm text-gray-500 w-1/12">{item.unidadMedida}</td>
                              <td className="px-2 py-4 whitespace-nowrap text-sm text-center w-1/12">
                                <input
                                  type="checkbox"
                                  checked={item.controlado}
                                  onChange={() => handleControlCheck(item.id)}
                                  className="form-checkbox h-4 w-4 text-indigo-600 rounded"
                                />
                              </td>
                              <td className="px-2 py-4 whitespace-nowrap text-sm font-medium w-1/12">
                                <button
                                  onClick={() => handleDelete(item.id)}
                                  className="text-red-600 hover:text-red-900 transition-colors duration-150"
                                >
                                  Eliminar
                                </button>
                              </td>
                            </tr>
                          ))
                        )}
                        <tr className="bg-gray-100">
                          <td colSpan="8" className="px-2 py-4 text-right font-bold text-sm text-gray-900">
                            Total de bultos escaneados:
                          </td>
                          <td className="px-2 py-4 whitespace-nowrap text-sm font-bold text-gray-900">
                            {items.length}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div className="flex space-x-4">
                  <button
                    onClick={generatePDF}
                    disabled={items.length === 0 || isGenerating || !isPdfLibLoaded}
                    className="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 transition-all duration-200 text-xl"
                  >
                    {isGenerating ? `Generando... (${generationStatus})` : isPdfLibLoaded ? 'Generar PDF' : 'Cargando PDF...'}
                  </button>
                  <button
                    onClick={handleReset}
                    className="w-full bg-gray-600 text-white font-semibold py-3 px-4 rounded-md shadow-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200 text-xl"
                  >
                    Nuevo Escaneo
                  </button>
                </div>
              </>
            )}
          </div>
        </div>
      );
    };

    // Render the App component into the #root div
    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
